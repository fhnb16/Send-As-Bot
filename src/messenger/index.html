<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Telegram Chat Bot Messenger</title>

      <link rel='stylesheet' type='text/css' href=''>
      <script type='text/javascript' src=''></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <style>
        /* Additional custom styles */
        body {
            background-color: #1a202c;
            color: #cbd5e0;
        }
        .editor-container {
            background-color: #2d374864;
            border: 1px solid #4a556832;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .btn {
            background-color: #4a5568;
            color: #cbd5e0;
        }
        .btn:hover {
            background-color: #2d3748;
        }
        .response-container {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .editor__button {
            background-color: #4a5568;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.3s;
        }
        
        .editor__button:hover {
            background-color: #2d3748;
        }
        
        .chat-log {
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
        }
        .chat-log__message {
            margin-bottom: 12px;
            max-width: 70%;
            padding: 12px;
            border-radius: 12px;
            font-size: 14px;
        }
        .chat-log__message--bot {
            background-color: #2d3748; /* Darker background for bot messages */
            color: white;
            margin-left: auto;
        }
        .chat-log__message--user {
            background-color: #4a5568; /* Dark background for user messages */
            color: white;
        }
        .chat-log__sender {
            font-size: 12px;
            margin-bottom: 4px;
            font-weight: bold;
        }
    </style>
      <style type='text/css'>
        /* Add your CSS here */
        
      </style>
</head>
<body>
    <header class="flex justify-between items-center p-4 bg-gray-800">
        <a href="https://dev.fhnb.ru" class="text-white text-xl">Home</a>
        <h1 class="text-white text-2xl">Chat Bot Messenger</h1>
        <select id="botChatsList" class="btn editor__button rounded">
            <!-- Options will be dynamically added by JavaScript -->
        </select>
    </header>

    <div class="container mx-auto mt-10 p-4">
        <div id="chatLog" class="chat-log bg-gray-800 rounded shadow-lg mb-4 hidden">
            <!-- Messages will be inserted here -->
        </div>
        <div class="editor-container">
            <div class="mb-4">
                <button class="btn editor__button mr-2" onclick="insertTag('b')">B</button>
                <button class="btn editor__button mr-2" onclick="insertTag('i')">I</button>
                <button class="btn editor__button mr-2" onclick="insertTag('u')">U</button>
                <button class="btn editor__button mr-2" onclick="insertTag('tg-spoiler')">Spoiler</button>
            </div>
            <textarea id="editor" class="w-full h-40 p-2 bg-gray-700 text-white rounded" placeholder="Enter your message here..."></textarea>
            <div class="mt-4 flex justify-between flex-wrap">
                <div class="inline-flex my-2">
                    <button class="btn editor__button px-4 py-2 mr-2 rounded" onclick="sendImageB64()">Send Image File</button>
                    <button class="btn editor__button px-4 py-2 rounded" onclick="sendImageURL()">Send Image URL</button>
                </div>
                <button class="btn editor__button px-4 py-2 rounded my-2" onclick="sendMessage()">Send Message</button>
            </div>
        </div>

        <div id="responseContainer" class="response-container hidden">
            <textarea id="responseField" class="w-full h-40 p-2 bg-gray-700 text-white rounded" readonly></textarea>
            <button id="deleteMessageBtn" class="btn editor__button mt-4 px-4 py-2 rounded" onclick="deleteMessage()">Delete Message</button>
        </div>
    </div>

<input type="file" id="imageFileInput" accept="image/*" class="hidden" onchange="handleImageFile()">

      <script type='text/javascript'>
var botID = `6709758051`;

// Sample chat ID data
var chatData = {
    'Чат БКТ': '-1002126986481',
    'Чат Donique': '-1001751736036',
    'Чат Томата': '-1001647320059',
    'Чат Ирины': '-1001939060717',
    // Add more chats as needed
};

// Populate the dropdown menu with chat IDs
var botChatsList = document.getElementById('botChatsList');
for (var [chatName, chatId] of Object.entries(chatData)) {
    var option = document.createElement('option');
    option.value = chatId;
    option.textContent = chatName;
    botChatsList.appendChild(option);
}

// Insert tag at cursor position or wrap selected text
function insertTag(tag) {
    var textarea = document.getElementById('editor');
    var start = textarea.selectionStart;
    var end = textarea.selectionEnd;
    var text = textarea.value;

    var before = text.substring(0, start);
    var selected = text.substring(start, end);
    var after = text.substring(end);

    if (selected) {
        textarea.value = before + `<${tag}>` + selected + `</${tag}>` + after;
    } else {
        textarea.value = before + `<${tag}></${tag}>` + after;
    }

    textarea.focus();
    textarea.setSelectionRange(start + tag.length + 2, end + tag.length + 2);
}

// Send the message to the Telegram API
function sendMessage() {
    var chatId = botChatsList.value;
    var text = encodeURIComponent(document.getElementById('editor').value);
    var url = `https://bot.fhnb.ru/proxy/sendMessage?chat_id=${chatId}&parse_mode=HTML&text=${text}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            displayResponse(data);
        })
        .catch(error => console.error('Error sending message:', error));
}

// Display the response in the response container
function displayResponse(data) {
    var responseContainer = document.getElementById('responseContainer');
    var responseField = document.getElementById('responseField');
    responseContainer.classList.remove('hidden');
    responseField.value = JSON.stringify(data, null, 4);

    // Save necessary data for message deletion
    document.getElementById('deleteMessageBtn').dataset.messageId = data.result.message_id;
    document.getElementById('deleteMessageBtn').dataset.chatId = data.result.chat.id;
}

// Delete the message
function deleteMessage() {
    var messageId = document.getElementById('deleteMessageBtn').dataset.messageId;
    var chatId = document.getElementById('deleteMessageBtn').dataset.chatId;
    var url = `https://bot.fhnb.ru/proxy/deleteMessage?chat_id=${chatId}&message_id=${messageId}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log('Message deleted:', data);
            displayResponse(data);
        })
        .catch(error => console.error('Error deleting message:', error));
}

function sendImageB64() {
    document.getElementById('imageFileInput').click();
}

// Handle image upload and send as base64 via POST
function handleImageFile() {
    var fileInput = document.getElementById('imageFileInput');
    var file = fileInput.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function (event) {
            var base64Image = event.target.result.split(',')[1];
            var chatId = botChatsList.value;
            var caption = document.getElementById('editor').value;

            // Convert base64 to a file object
            urltoFile(base64Image, 'image.jpeg')
                .then(function(file) {
                    var formData = new FormData();
                    formData.append('photo', file);
                    formData.append('caption', caption);

                    var url = `https://bot.fhnb.ru/proxy/sendPhoto?chat_id=${chatId}`;

                    // Send the POST request with the image data
                    fetch(url, {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        displayResponse(data);
                    })
                    .catch(error => console.error('Error sending image:', error));
                });
        };
        reader.readAsDataURL(file);
    }
}

// Helper function to convert a base64 string to a File object
function urltoFile(base64, filename) {
    return fetch(`data:image/jpeg;base64,${base64}`)
        .then(res => res.arrayBuffer())
        .then(buf => new File([buf], filename, { type: 'image/jpeg' }));
}

// Prompt user for URL and send as image
function sendImageURL() {
    var imageUrl = prompt("Enter the image URL:");
    if (imageUrl) {
        var caption = document.getElementById('editor').value;
        var chatId = botChatsList.value;

        var url = `https://bot.fhnb.ru/proxy/sendPhoto?chat_id=${chatId}&photo=${encodeURIComponent(imageUrl)}&caption=${encodeURIComponent(caption)}`;

        fetch(url, {
            method: 'GET',
        })
            .then(response => response.json())
            .then(data => {
                displayResponse(data);
            })
            .catch(error => console.error('Error sending image:', error));
    }
}
        

      </script>
    </body>
</html>
